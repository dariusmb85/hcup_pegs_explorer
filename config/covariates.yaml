# Exposure & Covariate Configuration

# Geographic resolution: "tract" or "zip5"
geo_mode: tract

# Amadeus features to extract
features:
  # HMS Smoke
  - id: hms_smoke_light
    source: hms
    var: prop_light_coverage
    agg: month
    description: "Proportion of light wilfire smoke cover"

  - id: hms_smoke_medium
    source: hms
    var: prop_med_coverage
    agg: month
    description: "Proportion of medium wilfire smoke cover"

  - id: hms_smoke_heavy
    source: hms
    var: prop_heavy_coverage
    agg: month
    description: "Proportion of heavy wilfire smoke cover"

  # PM2.5 dust concentration from merra2
  - id: pm25_dust
    source: merra2
    var: dusmass25
    agg: zip-month-year
    description: "Dust surface mass concentration, particles <2.5 μm (kg m⁻³)"

  - id: pm25_black_carbon
    source: merra2
    var: bcsmass
    agg: daily_max
    description: "Black carbon surface mass concentration (kg m⁻³)"

  # Ozone
  - id: ozone_daily_max_8hr
    source: aqs_daily_44201
    var: ozone
    agg: daily_8hr_max
    description: "Daily max 8-hour ozone (ppm)"

  # Temperature (if using gridMET or similar)
  - id: temp_min
    source: gridmet
    var: tmmn
    agg: daily
    description: "Mean temperature (°C)"

  - id: temp_max
    source: gridmet
    var: tmmx
    agg: daily
    description: "Maximum temperature (°C)"

  # Temperature
  - id: temp_maximum
    source: terra_climate
    var: tmax
    description: "Maximum temperature (°C)"

  - id: temp_minimum
    source: terra_climate
    var: tmin
    description: "Minimum temperature (°C)"


# Disease phenotype definitions (ICD-10-CM codes)
phenotypes:
  asthma:
    label: "Asthma"
    icd9_prefixes: ["493"]
    icd10_prefixes: ["J45"]
    description: "Asthma encounters"

  copd:
    label: "COPD"
    icd9_prefixes: ["491", "492", "496"]
    icd10_prefixes: ["J44"]
    description: "Chronic obstructive pulmonary disease"

  respiratory_infection:
    label: "Respiratory Infection"
    icd9_prefixes: ["460", "461", "462", "463", "464", "465", "466", "480", "481", "482", "483", "484", "485", "486",
                    "487"]
    icd10_prefixes: ["J00", "J01", "J02", "J03", "J04", "J05", "J06", "J09", "J10", "J11", "J12", "J13", "J14", "J15", "J16", "J17", "J18", "J20", "J21", "J22"]
    description: "Acute upper and lower respiratory infections"

  cardiovascular:
    label: "Cardiovascular Disease"
    icd9_prefixes: ["410", "411", "412", "413", "414"]
    icd10_prefixes: ["I20", "I21", "I22", "I23", "I24", "I25"]
    description: "Ischemic heart disease"

  stroke:
    label: "Stroke"
    icd9_prefixes: ["430", "431", "432", "433", "434", "435", "436", "437", "438"]
    icd10_prefixes: ["I60", "I61", "I62", "I63", "I64"]
    description: "Cerebrovascular accident"

  diabetes:
    label: "Diabetes"
    icd9_prefixes: ["250"]
    icd10_prefixes: ["E10", "E11", "E13"]
    description: "Diabetes mellitus"

  pregnancy:
    label: "Pregnancy/Delivery"
    icd9_prefixes: ["630", "631", "632", "633", "634", "635", "636", "637", "638", "639", "640", "641", "642", "643",
                    "644", "645", "646", "647", "648", "649", "650", "651", "652", "653", "654", "655", "656", "657",
                    "658", "659", "660", "661", "662", "663", "664", "665", "666", "667", "668", "669", "670", "671",
                    "672", "673", "674", "675", "676", "677", "678", "679", "V22", "V23", "V24", "V27", "V28"]
    icd10_prefixes: ["O"]
    description: "Pregnancy and childbirth complications"

  mental_health:
    label: "Mental Health"
    icd9_prefixes: ["290", "291", "292", "293", "294", "295", "296", "297", "298", "299", "300", "301", "302", "303",
                    "304", "305", "306", "307", "308", "309", "310", "311", "312", "313", "314", "315", "316", "317",
                    "318", "319"]
    icd10_prefixes: ["F"]
    description: "Mental and behavioral disorders"

# Rollup aggregations (for person-month exposures)
rollup_metrics:
  - id: mean
    description: "Mean value across days"
  - id: sum
    description: "Sum of values"
  - id: max
    description: "Maximum value"
  - id: p90
    description: "90th percentile"
  - id: days_available
    description: "Number of days with non-missing data"
  - id: days_above_threshold
    description: "Days exceeding threshold"


# Thresholds for binary exposure indicators
thresholds:
  pm25_unhealthy_sensitive: 35.5  # μg/m³ (AQI orange)
  pm25_unhealthy: 55.5  # μg/m³ (AQI red)
  ozone_unhealthy_sensitive: 0.070  # ppm
  temp_heat_warning: 32  # °C (~90°F)
  temp_cold_warning: 0   # °C (32°F)

# ExWAS model specifications
exwas_models:
  # Overall models
  - id: logit_unadjusted_overall
    strata: all
    outcome_type: binary
    family: binomial
    formula_template: "{outcome} ~ scale({exposure})"
    description: "Unadjusted - All"

  - id: logit_adjusted_temporal_overall
    strata: all
    outcome_type: binary
    family: binomial
    formula_template: "{outcome} ~ scale({exposure}) + year + factor(season)"
    description: "Temporal adjusted - All"

  - id: logit_adjusted_full_overall
    strata: all
    outcome_type: binary
    family: binomial
    formula_template: "{outcome} ~ scale({exposure}) + year + factor(season) + db_type + age + female + race"
    description: "Fully adjusted - All"

  # Male-only models
  - id: logit_unadjusted_male
    strata: male
    outcome_type: binary
    family: binomial
    formula_template: "{outcome} ~ scale({exposure})"
    description: "Unadjusted - Males"

  - id: logit_adjusted_temporal_male
    strata: male
    outcome_type: binary
    family: binomial
    formula_template: "{outcome} ~ scale({exposure}) + year + factor(season)"
    description: "Temporal adjusted - Males"

  - id: logit_adjusted_full_male
    strata: male
    outcome_type: binary
    family: binomial
    formula_template: "{outcome} ~ scale({exposure}) + year + factor(season) + db_type + age + race"
    description: "Fully adjusted - Males"

  # Female-only models
  - id: logit_unadjusted_female
    strata: female
    outcome_type: binary
    family: binomial
    formula_template: "{outcome} ~ scale({exposure})"
    description: "Unadjusted - Females"

  - id: logit_adjusted_temporal_female
    strata: female
    outcome_type: binary
    family: binomial
    formula_template: "{outcome} ~ scale({exposure}) + year + factor(season)"
    description: "Temporal adjusted - Females"

  - id: logit_adjusted_full_female
    strata: female
    outcome_type: binary
    family: binomial
    formula_template: "{outcome} ~ scale({exposure}) + year + factor(season) + db_type + age + race"
    description: "Fully adjusted - Females"

# Small cell suppression rules
suppression:
  min_cell_size: 11
  apply_to:
    - counts
    - geographic_aggregates

# Privacy settings
privacy:
  person_id_hash_algorithm: sha256
  date_precision: month  # Options: day, month, year
  geographic_precision: tract  # Options: tract, zip5, county, state
